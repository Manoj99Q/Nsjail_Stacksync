name: "python-sandbox"
description: "Python Sandbox for executing user-provided code"

mode: ONCE
hostname: "python-sandbox"
time_limit: 30
max_cpus: 1

# Resource limits
rlimit_as: 536870912  # 512 MB instead of 1 GB
rlimit_fsize: 10485760  # 10 MB
rlimit_nofile: 32
rlimit_nproc: 100
rlimit_stack: 10485760  # 10 MB

# Disable namespace features that don't work on Cloud Run
clone_newnet: false
clone_newuser: false
clone_newns: false
clone_newpid: false
clone_newipc: false
clone_newuts: false
clone_newcgroup: false

mount {
  src: "/"
  dst: "/"
  is_bind: true
  rw: false
}

mount {
  src: "/tmp"
  dst: "/tmp"
  is_bind: true
  rw: true
  mandatory: false
}

mount {
  src: "/usr"
  dst: "/usr"
  is_bind: true
  rw: false
}

mount {
  src: "/lib"
  dst: "/lib"
  is_bind: true
  rw: false
}

mount {
  src: "/lib64"
  dst: "/lib64"
  is_bind: true
  rw: false
  mandatory: false
}

mount {
  src: "/bin"
  dst: "/bin"
  is_bind: true
  rw: false
}

# Still use proc but without namespaces
mount {
  dst: "/proc"
  fstype: "proc"
}

envar: "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
envar: "PYTHONPATH=/usr/lib/python3/dist-packages"
envar: "LD_LIBRARY_PATH=/usr/local/lib:/usr/lib:/lib"

keep_caps: false
exec_bin {
  path: "/usr/bin/python3"
} 